import{t as b,e as T,a as c,s as P,n as Ie,b as Oe,c as Se}from"../chunks/BCViuYXD.js";import{i as De}from"../chunks/oBYXxpFJ.js";import{p as Ue,m as g,o as Re,t as y,g as a,b as Be,s as i,d,c as n,r as o,f as m,n as ee,h as Ee,k as Me}from"../chunks/BWjiBZrZ.js";import{a as ae,i as w,s as Ne}from"../chunks/B6c3gU6M.js";import{e as Ze,i as qe}from"../chunks/DdgEZlle.js";import{r as Z,s as He}from"../chunks/Dv00Ct0Q.js";import{b as q}from"../chunks/4Q9yigT1.js";import{u as te,p as Je}from"../chunks/i7Cjmawx.js";import{t as re}from"../chunks/DQVF6A3o.js";import{g as se}from"../chunks/CZFj2HiF.js";var Le=b('<p class="text-red-400 text-sm mt-1"> </p>'),Ve=b('<p class="text-red-400 text-sm mt-1"> </p>'),Ge=b('<p class="text-red-400 text-sm mt-1"> </p>'),Ke=b('<p class="text-red-400 text-sm mb-4"> </p>'),Qe=Ie('<svg class="animate-spin h-5 w-5 mr-2 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> 保存中...'),We=b('<p class="text-gray-400">你还没有完成任何题目，快去练习吧！</p>'),Xe=b('<li class="flex items-center justify-between bg-gray-700 p-3 rounded-lg hover:bg-gray-600 transition"><button class="text-blue-400 hover:text-blue-300 transition focus:outline-none focus:ring-2 focus:ring-blue-500"> </button> <span class="text-green-400">✓</span></li>'),Ye=b('<div class="max-h-96 overflow-auto"><ul class="space-y-3"></ul></div>'),ea=b('<div class="min-h-screen bg-gray-900 p-6"><div class="container mx-auto"><h1 class="text-4xl font-bold text-blue-400 mb-8 text-center">个人中心</h1> <div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 bg-gradient-to-br from-gray-800 to-gray-900 hover:shadow-xl transition-shadow duration-300"><h2 class="text-2xl font-semibold text-white mb-6">用户信息</h2> <div class="flex items-center space-x-4 mb-6"><img alt="用户头像" class="w-20 h-20 rounded-full object-cover border-2 border-blue-500"> <div class="flex space-x-2"><label for="avatar-upload" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500">更换头像</label> <button class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 disabled:bg-gray-700 transition focus:outline-none focus:ring-2 focus:ring-blue-500">撤销</button> <input type="file" id="avatar-upload" accept="image/*" class="hidden"></div></div> <div class="mb-6"><label for="username" class="block text-gray-300 mb-2 font-medium">用户名</label> <input type="text" id="username" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"> <!></div> <div class="mb-6"><label for="old-password" class="block text-gray-300 mb-2 font-medium">旧密码</label> <input type="password" id="old-password" placeholder="请输入旧密码" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"> <!></div> <div class="mb-6"><label for="new-password" class="block text-gray-300 mb-2 font-medium">新密码</label> <input type="password" id="new-password" placeholder="留空则不修改" class="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"> <!></div> <!> <button class="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center justify-center"><!></button></div> <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 bg-gradient-to-br from-gray-800 to-gray-900 hover:shadow-xl transition-shadow duration-300"><h2 class="text-2xl font-semibold text-white mb-6">已完成题目</h2> <!></div></div></div></div>');function ca(oe,ie){var W,X;Ue(ie,!1);const[H,ne]=Ne(),v=()=>ae(te,"$user",H),le=()=>ae(Je,"$progress",H);let f=g(((W=v())==null?void 0:W.username)||""),x=g(""),p=g(""),h=g(null),j=g(((X=v())==null?void 0:X.avatar)||"/favicon.png"),z=g([]),_=g(!1),r=g({});Re(()=>{v()||se("/login"),d(z,le().filter(e=>e.completed))});function de(){var e;return d(r,{}),a(f)&&a(f)!==((e=v())==null?void 0:e.username)&&(/^[a-zA-Z0-9_]{3,20}$/.test(a(f))||m(r,a(r).username="用户名必须为 3-20 个字符，仅允许字母、数字和下划线")),a(p)?(a(x)||m(r,a(r).oldPassword="请输入旧密码"),(a(p).length<8||!/[a-zA-Z]/.test(a(p))||!/[0-9]/.test(a(p)))&&m(r,a(r).newPassword="新密码必须至少 8 位，包含字母和数字")):a(x)&&m(r,a(r).newPassword="请输入新密码"),Object.keys(a(r)).length===0}function ue(e){const t=e.target;if(t.files&&t.files[0]){d(h,t.files[0]);const s=new FileReader;s.onload=u=>{var l;d(j,(l=u.target)==null?void 0:l.result)},s.readAsDataURL(a(h))}}function ce(){var t;d(h,null),d(j,((t=v())==null?void 0:t.avatar)||"/favicon.png");const e=document.getElementById("avatar-upload");e&&(e.value="")}async function ve(){var t;if(a(_)||!de())return;d(_,!0);const e={};if(a(f)&&a(f)!==((t=v())==null?void 0:t.username)&&(e.newUsername=a(f)),a(p)&&(e.oldPassword=a(x),e.password=a(p)),a(h)){const s=new FormData;s.append("avatar",a(h));const u=await fetch("/api/upload",{method:"POST",body:s,credentials:"include"});if(u.ok){const{path:l}=await u.json();e.avatar=l,d(j,l)}else{const{message:l}=await u.json();m(r,a(r).upload=`上传头像失败：${l}`),d(_,!1);return}}if(Object.keys(e).length>0){const s=await fetch("/api/user/update",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(s.ok){const u={...v(),username:e.newUsername||v().username,avatar:e.avatar||v().avatar};te.set(u),d(x,""),d(p,""),d(r,{});const l=document.createElement("div");l.className="fixed top-4 right-4 bg-green-600 text-white p-4 rounded-lg shadow-lg z-50",l.textContent="用户信息已更新！",document.body.appendChild(l),setTimeout(()=>l.remove(),3e3)}else{const{error:u}=await s.json();u==="旧密码错误"?m(r,a(r).oldPassword=u):m(r,a(r).api=`更新失败：${u}`)}}else m(r,a(r).api="没有需要更新的信息！");d(_,!1)}function pe(e){se(`/editor?taskId=${e}`)}De();var A=ea(),J=n(A),L=i(n(J),2),F=n(L),I=i(n(F),2),V=n(I),G=i(V,2),O=i(n(G),2),fe=i(O,2);o(G),o(I);var S=i(I,2),D=i(n(S),2);Z(D);var ge=i(D,2);{var me=e=>{var t=Le(),s=n(t,!0);o(t),y(()=>P(s,a(r).username)),c(e,t)};w(ge,e=>{a(r).username&&e(me)})}o(S);var U=i(S,2),R=i(n(U),2);Z(R);var be=i(R,2);{var we=e=>{var t=Ve(),s=n(t,!0);o(t),y(()=>P(s,a(r).oldPassword)),c(e,t)};w(be,e=>{a(r).oldPassword&&e(we)})}o(U);var B=i(U,2),E=i(n(B),2);Z(E);var xe=i(E,2);{var he=e=>{var t=Ge(),s=n(t,!0);o(t),y(()=>P(s,a(r).newPassword)),c(e,t)};w(xe,e=>{a(r).newPassword&&e(he)})}o(B);var K=i(B,2);{var _e=e=>{var t=Ke(),s=n(t,!0);o(t),y(()=>P(s,a(r).api)),c(e,t)};w(K,e=>{a(r).api&&e(_e)})}var $=i(K,2),ye=n($);{var ke=e=>{var t=Qe();ee(),c(e,t)},Pe=e=>{var t=Oe("保存修改");c(e,t)};w(ye,e=>{a(_)?e(ke):e(Pe,!1)})}o($),o(F);var Q=i(F,2),je=i(n(Q),2);{var $e=e=>{var t=We();c(e,t)},Ce=e=>{var t=Ye(),s=n(t);Ze(s,5,()=>a(z),qe,(u,l)=>{var Y=Se(),Te=Ee(Y);{var ze=M=>{var k=Xe(),N=n(k),Ae=n(N,!0);o(N),ee(2),o(k),y(C=>P(Ae,C),[()=>{var C;return(C=re.find(Fe=>Fe.id===a(l).taskId))==null?void 0:C.title}],Me),T("click",N,()=>pe(a(l).taskId)),c(M,k)};w(Te,M=>{re.find(k=>k.id===a(l).taskId)&&M(ze)})}c(u,Y)}),o(s),o(t),c(e,t)};w(je,e=>{a(z).length===0?e($e):e(Ce,!1)})}o(Q),o(L),o(J),o(A),y(()=>{He(V,"src",a(j)),O.disabled=!a(h),$.disabled=a(_)}),T("click",O,ce),T("change",fe,ue),q(D,()=>a(f),e=>d(f,e)),q(R,()=>a(x),e=>d(x,e)),q(E,()=>a(p),e=>d(p,e)),T("click",$,ve),c(oe,A),Be(),ne()}export{ca as component};
