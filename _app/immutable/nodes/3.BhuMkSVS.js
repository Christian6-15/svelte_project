import{t as b,e as M,a as p,s as m,c as Lt}from"../chunks/BCViuYXD.js";import{i as ge}from"../chunks/oBYXxpFJ.js";import{p as ye,o as _e,a as he,t as O,b as xe,s as i,c as s,d as r,m as I,g as t,e as we,r as a,f as ke,h as kt}from"../chunks/BWjiBZrZ.js";import{i as y,s as Oe,a as je}from"../chunks/B6c3gU6M.js";import{e as Ct,i as Ut}from"../chunks/DdgEZlle.js";import{h as Ot}from"../chunks/BSbBwUZB.js";import{s as Y}from"../chunks/C2AOTDu5.js";import{b as Nt}from"../chunks/BKUw7nab.js";import{t as tt}from"../chunks/DQVF6A3o.js";import{c as Te,p as Pe}from"../chunks/i7Cjmawx.js";var Ie=b('<span class="text-green-400">✔</span>'),Ee=b('<span class="text-gray-400">○</span>'),Se=b('<button><span class="truncate"> </span> <!></button>'),Ae=b('<hr class="border-t border-gray-600 my-4">'),Le=b('<h4 class="text-lg font-semibold text-white mt-4 mb-4"> </h4>'),Ce=b('<p class="mt-2 mb-2 whitespace-pre-wrap"> </p>'),Ue=b('<pre class="bg-gray-700 p-2 rounded border border-gray-600 text-gray-200 whitespace-pre-wrap my-2"><!></pre>'),Ne=b('<p class="mt-2 mb-2 whitespace-pre-wrap"><span class="font-bold">注意：</span> </p>'),ze=b('<p class="mt-2 mb-2 whitespace-pre-wrap"> </p>'),De=b("<!> <!>",1),Re=b('<div class="mt-4"><h3 class="text-lg font-semibold text-gray-200 mb-4">📚 学习内容</h3> <div class="text-gray-300"></div></div>'),Ve=b('<div class="mt-4"><p class="text-gray-400 mb-2">💡 提示：</p> <p class="text-gray-300"> </p></div>'),Be=b('<pre class="text-gray-300 bg-gray-700 p-2 rounded border border-gray-600 whitespace-pre-wrap"> </pre>'),Me=b('<pre class="text-gray-300 bg-gray-700 p-2 rounded border border-gray-600 whitespace-pre-wrap">无</pre>'),Xe=b('<pre class="text-gray-300 bg-gray-700 p-2 rounded border border-gray-600 whitespace-pre-wrap"> </pre>'),He=b('<pre class="text-gray-300 bg-gray-700 p-2 rounded border border-gray-600 whitespace-pre-wrap"> </pre>'),Je=b('<pre class="text-gray-300 bg-gray-700 p-2 rounded border border-gray-600 whitespace-pre-wrap">无</pre>'),Ke=b('<div class="h-full overflow-auto bg-gray-800"><div class="p-4 flex space-x-2 border-b border-gray-600"><button class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:bg-gray-400 transition focus:outline-none focus:ring-2 focus:ring-blue-400">上一题</button> <button class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:bg-gray-400 transition focus:outline-none focus:ring-2 focus:ring-blue-400">下一题</button></div> <div class="p-4"><h2 class="text-xl font-bold text-white mb-4"> </h2> <p class="text-gray-300 mb-4"> </p> <!> <!> <div class="mt-4"><p class="text-gray-400 mb-2">📥 输入样例：</p> <!></div> <div class="mt-4"><p class="text-gray-400 mb-2">📤 输出样例：</p> <!></div></div></div>'),We=b('<div class="flex flex-col h-[calc(100vh-4rem)] overflow-hidden"><div class="flex flex-1 overflow-hidden"><div><div class="flex justify-between items-center mb-4"><h2>任务列表</h2> <button> </button></div> <div></div></div> <div class="flex-1 flex flex-row overflow-hidden"><div class="w-5/10 border-l-2 border-r-2 border-t-2 border-gray-600"><!></div> <div class="w-5/10 border-t-2 border-gray-600 flex flex-col"><div class="bg-gray-800 p-4 flex space-x-2 border-b border-gray-600"><button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-600 transition focus:outline-none focus:ring-2 focus:ring-blue-400">运行代码</button> <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-600 transition focus:outline-none focus:ring-2 focus:ring-blue-400">提交</button></div> <div class="w-full flex-1"></div></div></div></div> <button class="fixed bottom-4 right-4 w-10 h-10 flex items-center justify-center rounded-full bg-blue-600 text-white hover:bg-blue-700 z-50 transition focus:outline-none focus:ring-2 focus:ring-blue-400"> </button> <div><h3 class="text-lg font-semibold text-white mb-2"> </h3> <div class="text-gray-300 h-48 overflow-auto mb-4 bg-gray-700 p-2 rounded-lg whitespace-pre-wrap"><!></div></div></div>');function ar(zt,Dt){ye(Dt,!1);const[Rt,Vt]=Oe(),Bt=()=>je(Pe,"$progress",Rt);let _,L="",w=I(""),f=[],$=I(""),j=[],c=I(null),E=I(0),z=I(!0),h,et=I(),D=I(!0),S=I(!1),R=I(!1),A="",q=null,X=I(null);function Mt(e){return Bt().some(o=>o.taskId===e&&o.completed)||!1}_e(async()=>{const e=new URLSearchParams(window.location.search),o=parseInt(e.get("taskId")||"1",10),n=tt.findIndex(g=>g.id===o);n!==-1?(r(E,n),r(c,tt[t(E)])):(r(w,`错误：未找到任务 ID ${o}，请从进度页面重新进入。`),r(S,!0));const x=["https://cdnjs.cloudflare.com/ajax/libs/ace/1.37.1/ace.min.js","https://cdnjs.cloudflare.com/ajax/libs/ace/1.37.1/mode-python.min.js","https://cdnjs.cloudflare.com/ajax/libs/ace/1.37.1/theme-dracula.min.js","https://cdnjs.cloudflare.com/ajax/libs/ace/1.37.1/ext-language_tools.min.js"].map(g=>new Promise(T=>{const C=document.createElement("script");C.src=g,C.async=!1,C.onload=()=>T(),document.head.appendChild(C)}));await Promise.all(x),await we(),t(et)?(h=ace.edit(t(et)),h.setTheme("ace/theme/dracula"),h.session.setMode("ace/mode/python"),h.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,fontSize:20,showLineNumbers:!0,tabSize:4,useSoftTabs:!0,minLines:10,wrap:!0,useWorker:!1}),h.setValue(L,-1),h.on("change",()=>{L=h.getValue()})):console.error("editorContainer 未绑定"),await Xt()});async function Xt(){const e=document.createElement("script");return e.src="/pyodide/pyodide.js",new Promise(o=>{e.onload=async()=>{_=await globalThis.loadPyodide({indexURL:"/pyodide/"}),await _.runPythonAsync(`
            import builtins
            original_print = builtins.print
          `),o()},document.head.appendChild(e)})}function nt(){t(X)&&ke(X,t(X).scrollTop=t(X).scrollHeight)}function Ht(){return new Promise(e=>{q=e,r(R,!0),A="",f.push(A),r(w,f.join(`
`)+'<span class="cursor"></span>'),nt();const o=n=>{if(!(!t(R)||!q)){if(n.key==="Enter"){n.preventDefault();const l=A;f[f.length-1]=l,r(w,f.join(`
`)),q(l),q=null,r(R,!1),window.removeEventListener("keydown",o)}else n.key==="Backspace"?(A=A.slice(0,-1),f[f.length-1]=A,r(w,f.join(`
`)+'<span class="cursor"></span>')):n.key.length===1&&(A+=n.key,f[f.length-1]=A,r(w,f.join(`
`)+'<span class="cursor"></span>'));nt()}};window.addEventListener("keydown",o)})}async function Jt(){if(!L.trim()){r(w,"请先输入代码！"),f=["请先输入代码！"],r(S,!0),r(z,!0);return}r(z,!0),f=[],r(w,""),r(S,!0),r(R,!0);try{_.globals.set("appendOutput",l=>{f.push(l),r(w,f.join(`
`)),nt()}),await _.runPythonAsync(`
          def custom_print(*args, **kwargs):
            output = ' '.join(str(arg) for arg in args)
            appendOutput(output)
            return None

          import builtins
          builtins.print = custom_print
        `),_.globals.set("promptUser",Ht),await _.runPythonAsync(`
          async def custom_input(prompt=""):
            if prompt:
              appendOutput(prompt)
            user_input = await promptUser()
            return user_input

          import builtins
          builtins.input = custom_input
        `);const n=`
import asyncio

async def user_code():
${L.split(`
`).map(l=>"    "+l.replace(/\binput\(/g,"await input(")).join(`
`)}
    return None

await user_code()
        `;await _.runPythonAsync(n)}catch(e){f.push(String(e)),r(w,f.join(`
`))}finally{r(R,!1),q=null,A=""}}async function Kt(){var e;if(!L.trim()){r($,"请先输入代码！"),j=["请先输入代码！"],r(S,!0),r(z,!1);return}r(z,!1),j=[],r($,""),r(S,!0);try{await _.runPythonAsync(`
          import builtins
          builtins.print = original_print
        `);const o=((e=t(c))==null?void 0:e.input)||"";await _.runPythonAsync(`
          import sys
          from io import StringIO
          sys.stdin = StringIO(${JSON.stringify(o+`
`)})
          sys.stdout = StringIO()
        `);const n=await _.runPythonAsync(L),x=_.globals.get("sys").stdout.getvalue()||(n?n.toString():"");if(t(c)&&t(c).expectedOutput){const g=x.trim(),T=t(c).expectedOutput.trim();g===T?(j.push("🎉 提交成功，任务完成！"),await Te(t(c).id)):(j.push("😓 提交失败，输出不正确！"),j.push(`你的输出：
${g}`),j.push(`期望输出：
${T}`))}else j.push("😓 提交失败：任务配置错误！")}catch(o){j.push(`错误日志：
${String(o)}`)}finally{await _.runPythonAsync(`
          def custom_print(*args, **kwargs):
            output = ' '.join(str(arg) for arg in args)
            appendOutput(output)
            return None

          import builtins
          builtins.print = custom_print
        `)}r($,j.join(`
`))}function it(e){r(E,e),r(c,tt[t(E)]),L="",h&&h.setValue(L,-1),r(w,""),f=[],r($,""),j=[],r(z,!0)}he(()=>{h&&(h.destroy(),h.container.remove())});function Wt(e){return e.split(`

`).map(n=>{const l=n.match(/^\[(.*?)\](.*)/s);if(l){const x=l[1],g=l[2].trim();return{type:x,content:g}}return{type:"TEXT",content:n}})}ge();var lt=We(),ut=s(lt),rt=s(ut),pt=s(rt),jt=s(pt),at=i(jt,2),Yt=s(at,!0);a(at),a(pt);var ct=i(pt,2);Ct(ct,5,()=>tt,Ut,(e,o,n)=>{var l=Se(),x=s(l),g=s(x,!0);a(x);var T=i(x,2);{var C=U=>{var H=Ie();p(U,H)},F=U=>{var H=Ee();p(U,H)};y(T,U=>{Mt(t(o).id)?U(C):U(F,!1)})}a(l),O(()=>{Y(l,1,`w-full p-3 rounded text-left ${(t(E)===n?"bg-blue-600":"bg-gray-700")??""} text-gray-200 flex justify-between items-center hover:bg-blue-500 transition my-2 focus:outline-none focus:ring-2 focus:ring-blue-400`),m(g,t(o).title)}),M("click",l,()=>it(n)),p(e,l)}),a(ct),a(rt);var Tt=i(rt,2),dt=s(Tt),$t=s(dt);{var qt=e=>{var o=Ke(),n=s(o),l=s(n),x=i(l,2);a(n);var g=i(n,2),T=s(g),C=s(T,!0);a(T);var F=i(T,2),U=s(F,!0);a(F);var H=i(F,2);{var re=u=>{var v=Re(),k=i(s(v),2);Ct(k,5,()=>Wt(t(c).tutorial),Ut,(G,d,N)=>{var ot=De(),At=kt(ot);{var pe=P=>{var V=Ae();p(P,V)};y(At,P=>{(N===1||N>1&&(t(d).type==="CODE"||t(d).type==="OUTPUT"))&&P(pe)})}var ce=i(At,2);{var de=P=>{var V=Le(),_t=s(V,!0);a(V),O(()=>m(_t,t(d).content)),p(P,V)},ve=(P,V)=>{{var _t=J=>{var Q=Ce(),ht=s(Q,!0);a(Q),O(()=>m(ht,t(d).content)),p(J,Q)},be=(J,Q)=>{{var ht=K=>{var Z=Ue(),xt=s(Z);Ot(xt,()=>t(d).content),a(Z),p(K,Z)},fe=(K,Z)=>{{var xt=W=>{var B=Ne(),wt=i(s(B));a(B),O(()=>m(wt,` ${t(d).content??""}`)),p(W,B)},me=W=>{var B=ze(),wt=s(B,!0);a(B),O(()=>m(wt,t(d).content)),p(W,B)};y(K,W=>{t(d).type==="NOTE"?W(xt):W(me,!1)},Z)}};y(J,K=>{t(d).type==="CODE"||t(d).type==="OUTPUT"?K(ht):K(fe,!1)},Q)}};y(P,J=>{t(d).type==="INTRO"||t(d).type==="SYNTAX"?J(_t):J(be,!1)},V)}};y(ce,P=>{t(d).type==="TITLE"?P(de):P(ve,!1)})}p(G,ot)}),a(k),a(v),p(u,v)};y(H,u=>{t(c).tutorial&&u(re)})}var Et=i(H,2);{var ae=u=>{var v=Ve(),k=i(s(v),2),G=s(k,!0);a(k),a(v),O(()=>m(G,t(c).hint)),p(u,v)};y(Et,u=>{t(c).hint&&u(ae)})}var yt=i(Et,2),se=i(s(yt),2);{var oe=u=>{var v=Be(),k=s(v,!0);a(v),O(()=>m(k,t(c).inputExample)),p(u,v)},ne=u=>{var v=Me();p(u,v)};y(se,u=>{t(c).inputExample?u(oe):u(ne,!1)})}a(yt);var St=i(yt,2),ie=i(s(St),2);{var le=u=>{var v=Xe(),k=s(v,!0);a(v),O(()=>m(k,t(c).outputExample)),p(u,v)},ue=(u,v)=>{{var k=d=>{var N=He(),ot=s(N,!0);a(N),O(()=>m(ot,t(c).expectedOutput)),p(d,N)},G=d=>{var N=Je();p(d,N)};y(u,d=>{t(c).expectedOutput?d(k):d(G,!1)},v)}};y(ie,u=>{t(c).outputExample?u(le):u(ue,!1)})}a(St),a(g),a(o),O(()=>{l.disabled=t(E)===0,x.disabled=t(E)===tt.length-1,m(C,t(c).title),m(U,t(c).description)}),M("click",l,()=>it(t(E)-1)),M("click",x,()=>it(t(E)+1)),p(e,o)};y($t,e=>{t(c)&&e(qt)})}a(dt);var Pt=i(dt,2),vt=s(Pt),bt=s(vt),It=i(bt,2);a(vt);var Ft=i(vt,2);Nt(Ft,e=>r(et,e),()=>t(et)),a(Pt),a(Tt),a(ut);var st=i(ut,2),Gt=s(st,!0);a(st);var ft=i(st,2),mt=s(ft),Qt=s(mt,!0);a(mt);var gt=i(mt,2),Zt=s(gt);{var te=e=>{var o=Lt(),n=kt(o);Ot(n,()=>t(w)),p(e,o)},ee=e=>{var o=Lt(),n=kt(o);Ot(n,()=>t($)),p(e,o)};y(Zt,e=>{t(z)?e(te):e(ee,!1)})}a(gt),Nt(gt,e=>r(X,e),()=>t(X)),a(ft),a(lt),O(()=>{Y(rt,1,`${(t(D)?"w-48":"w-0")??""} bg-gray-900 p-2 transition-all duration-300 border-t-2 border-gray-600`),Y(jt,1,`text-xl font-semibold text-blue-400 ${(t(D)?"block":"hidden")??""}`),Y(at,1,`text-white hover:text-gray-300 w-8 h-8 flex items-center justify-center rounded-full bg-blue-600 fixed top-1/2 transform -translate-y-1/2 ${(t(D)?"left-44":"left-2")??""} z-50 focus:outline-none focus:ring-2 focus:ring-blue-400`),m(Yt,t(D)?"<":">"),Y(ct,1,`h-[calc(100%-4rem)] overflow-auto ${(t(D)?"block":"hidden")??""}`),bt.disabled=t(R),It.disabled=t(R),m(Gt,t(S)?"v":"^"),Y(ft,1,`${(t(S)?"h-80 opacity-100 p-4 border-t border-gray-600":"h-0 opacity-0 p-0")??""} fixed bottom-0 left-0 right-0 bg-gray-800 z-40 transition-all duration-300`),m(Qt,t(z)?"运行结果":"提交结果")}),M("click",at,()=>r(D,!t(D))),M("click",bt,()=>{Jt()}),M("click",It,()=>{Kt()}),M("click",st,()=>r(S,!t(S))),p(zt,lt),xe(),Vt()}export{ar as component};
