import{a3 as i}from"./BWjiBZrZ.js";const n=i(null),t=i([]);async function l(){try{const e=await fetch("/api/user",{credentials:"include"});if(e.ok){const s=await e.json();s&&!s.error?(n.set(s),t.set(s.progress||[])):(n.set(null),t.set([]))}else n.set(null),t.set([])}catch(e){console.error("初始化用户失败:",e),n.set(null),t.set([])}}async function u(e){try{const s=await fetch("/api/complete-task",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:e}),credentials:"include"});if(s.ok){const{progress:o}=await s.json();t.set(o)}else console.error("完成任务失败:",await s.json())}catch(s){console.error("完成任务失败:",s)}}async function p(e,s){try{if((await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:s}),credentials:"include"})).ok){const r=await a();return r?(n.set(r),t.set(r.progress||[]),console.log("Loaded progress on login:",r.progress||[]),!0):!1}return!1}catch(o){return console.error("登录失败:",o),!1}}async function f(e,s){try{if((await fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:s}),credentials:"include"})).ok){const r=await a();return r?(n.set(r),t.set(r.progress||[]),console.log("Initialized progress on register:",r.progress||[]),!0):!1}return!1}catch(o){return console.error("注册失败:",o),!1}}async function d(){const e=await a();e&&console.log("Saved progress on logout:",e.progress),await fetch("/api/logout",{method:"POST",credentials:"include"}),n.set(null),t.set([])}async function a(){try{const e=await fetch("/api/user",{credentials:"include"});return e.ok?await e.json():null}catch(e){return console.error("获取用户信息失败:",e),null}}export{d as a,u as c,l as i,p as l,t as p,f as r,n as u};
